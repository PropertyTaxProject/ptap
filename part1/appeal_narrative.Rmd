---
output: pdf_document
params:
  PIN:
    label: "PIN"
    value: "NA"
    input: text
  inputdata:
    label: "DataFrame"
    value: ""
title: '`r paste0("Appeal Narrative for ", params$PIN)`'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
library(knitr)
library(kableExtra)
library(tidyverse)
library(scales)

data <- params$inputdata %>% as.data.frame()
comps <- data %>% filter(Status == "Comparable")
target_pin <- data %>% filter(Status != "Comparable")

mean_comps <- mean(comps$`Assessed Value`)

pct_diff <- (mean_comps - target_pin$`Assessed Value`) / target_pin$`Assessed Value`

if(pct_diff < 0){
  diff_txt <- "less than"
} else {
  print("comparables invalid")
}

```

# An Appeal on Uniformity

Utilizing data released from the Cook County Assessor's Office, including [Property Characteristics](https://datacatalog.cookcountyil.gov/Property-Taxation/Cook-County-Assessor-s-Residential-Property-Charac/bcnq-qi2z), the following properties are identified as comparables valued less than `r params$PIN` (`r target_pin["Property Address"]`).

These comparables have an average assessed value of `r dollar(mean_comps)` which is `r paste0( percent(abs(pct_diff)), " ", diff_txt, " ", params$PIN, "'s assessed value of ", dollar(target_pin["Assessed Value"][[1]]))`.

### Suggested Comparables

```{r}
kable(comps %>% 
        select(PIN,
               `Property Address`,
               `Assessed Value`) %>%
        mutate(`Assessed Value` = dollar(`Assessed Value`)
  )
)
```

# Analysis of Comparables

These comparables are highly similar to `r target_pin$PIN`. 

```{r}
kable(data %>% select(
  PIN,
  Status,
  Class,
  Distance,
  Age,
  Rooms,
  Bedrooms,
  Basement
))
```

&nbsp;

```{r}
kable(
  data %>% select(
    PIN,
    `Type of Residence`,
    `Building SQFT`,
    `Land SQFT`,
    `Garage indicator`,
    `Wall Material`,
  )
)
```

